{
  "type": "integration",
  "pattern": "api-route",
  "description": "Template para teste de API route Next.js",

  "template": "import { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { GET, POST, PUT, DELETE } from '@/app/api/{{API_PATH}}/route'\n\n// Mock Prisma ou database\nvi.mock('@/lib/db', () => ({\n  prisma: {\n    {{MODEL}}: {\n      findMany: vi.fn(),\n      findUnique: vi.fn(),\n      create: vi.fn(),\n      update: vi.fn(),\n      delete: vi.fn(),\n    },\n  },\n}))\n\ndescribe('API Route: /api/{{API_PATH}}', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  describe('GET', () => {\n    it('should return data successfully', async () => {\n      const mockData = [{ id: 1, name: 'Test' }]\n      const { prisma } = await import('@/lib/db')\n      prisma.{{MODEL}}.findMany.mockResolvedValue(mockData)\n\n      const request = new Request('http://localhost:3000/api/{{API_PATH}}')\n      const response = await GET(request)\n      const data = await response.json()\n\n      expect(response.status).toBe(200)\n      expect(data).toEqual(mockData)\n    })\n\n    it('should handle errors', async () => {\n      const { prisma } = await import('@/lib/db')\n      prisma.{{MODEL}}.findMany.mockRejectedValue(new Error('Database error'))\n\n      const request = new Request('http://localhost:3000/api/{{API_PATH}}')\n      const response = await GET(request)\n\n      expect(response.status).toBe(500)\n    })\n  })\n\n  describe('POST', () => {\n    it('should create new resource', async () => {\n      const newData = { name: 'New Item' }\n      const { prisma } = await import('@/lib/db')\n      prisma.{{MODEL}}.create.mockResolvedValue({ id: 1, ...newData })\n\n      const request = new Request('http://localhost:3000/api/{{API_PATH}}', {\n        method: 'POST',\n        body: JSON.stringify(newData),\n      })\n      const response = await POST(request)\n      const data = await response.json()\n\n      expect(response.status).toBe(201)\n      expect(data).toHaveProperty('id')\n    })\n\n    it('should validate request body', async () => {\n      const invalidData = {}\n\n      const request = new Request('http://localhost:3000/api/{{API_PATH}}', {\n        method: 'POST',\n        body: JSON.stringify(invalidData),\n      })\n      const response = await POST(request)\n\n      expect(response.status).toBe(400)\n    })\n  })\n})\n",

  "withAuth": "import { describe, it, expect, vi } from 'vitest'\nimport { GET } from '@/app/api/{{API_PATH}}/route'\nimport { auth } from '@/auth'\n\nvi.mock('@/auth', () => ({\n  auth: vi.fn(),\n}))\n\ndescribe('API Route: /api/{{API_PATH}} (Protected)', () => {\n  it('should return 401 if not authenticated', async () => {\n    auth.mockResolvedValue(null)\n\n    const request = new Request('http://localhost:3000/api/{{API_PATH}}')\n    const response = await GET(request)\n\n    expect(response.status).toBe(401)\n  })\n\n  it('should return data if authenticated', async () => {\n    auth.mockResolvedValue({ user: { id: '1', role: 'user' } })\n\n    const request = new Request('http://localhost:3000/api/{{API_PATH}}')\n    const response = await GET(request)\n\n    expect(response.status).toBe(200)\n  })\n})\n"
}

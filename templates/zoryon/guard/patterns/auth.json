{
  "pattern": "auth",
  "name": "Authentication Middleware",
  "description": "Valida autenticação e protege rotas",

  "providers": {
    "clerk": {
      "template": "import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'\n\nconst isPublicRoute = createRouteMatcher([\n  '/',\n  '/sign-in(.*)',\n  '/sign-up(.*)',\n  '/api/webhooks(.*)',\n])\n\nexport default clerkMiddleware((auth, request) => {\n  if (!isPublicRoute(request)) {\n    auth().protect()\n  }\n})"
    },
    "nextauth": {
      "template": "import { auth } from '@/auth'\n\nexport default auth((req) => {\n  const isLoggedIn = !!req.auth\n  const isPublicRoute = [\n    '/',\n    '/login',\n    '/register',\n    '/api/auth/callback',\n  ].some(route => req.nextUrl.pathname.startsWith(route))\n\n  if (!isLoggedIn && !isPublicRoute) {\n    return Response.redirect(new URL('/login', req.url))\n  }\n})"
    },
    "custom": {
      "template": "import { NextResponse } from 'next/server'\nimport type { NextRequest } from 'next/server'\nimport { jwtVerify } from 'jose'\n\nconst publicPaths = ['/', '/login', '/register']\n\nexport async function authMiddleware(request: NextRequest) {\n  const { pathname } = request.nextUrl\n\n  // Skip public routes\n  if (publicPaths.some(path => pathname.startsWith(path))) {\n    return NextResponse.next()\n  }\n\n  // Get token from cookie\n  const token = request.cookies.get('session')?.value\n\n  if (!token) {\n    return NextResponse.redirect(new URL('/login', request.url))\n  }\n\n  try {\n    // Verify JWT\n    const secret = new TextEncoder().encode(process.env.JWT_SECRET)\n    const { payload } = await jwtVerify(token, secret)\n\n    // Add user to headers (accessible in route handlers)\n    const response = NextResponse.next()\n    response.headers.set('x-user-id', payload.sub as string)\n\n    return response\n  } catch (error) {\n    // Invalid token\n    return NextResponse.redirect(new URL('/login', request.url))\n  }\n}"
    }
  },

  "patterns": {
    "route_protection": "Protege rotas específicas",
    "role_check": "Valida roles/permissões",
    "session_refresh": "Renova sessão automaticamente",
    "api_protection": "Protege API routes"
  }
}
